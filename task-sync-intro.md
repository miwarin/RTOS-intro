# タスク間同期通信

タスク間同期通信は複数のタスクの実行を制御したり、タスク間でデータを送受信するためのものである。

ITRON 仕様にはタスク間同期通信がいくつかあるがここではセマフォ、イベントフラグ、ミューテックスについて取り上げる。

* セマフォ
  * 排他制御や同期制御に使う。バイナリセマフォと計数セマフォがある
  * バイナリセマフォ: 初期値 0 のセマフォ。おもにタスクの同期処理に使う
  * 計数セマフォ: 初期値 1 以上のセマフォ。wai_sem してもタスクは待たされない
  * 優先度逆転、デッドロックに注意
  * ミューテックスに比べて処理が軽い
* イベントフラグ
  * イベントの有無をビット毎のフラグで表現し、同期をおこなう
  * 優先度逆転、デッドロックに注意
* ミューテックス
  * ミューテックスはバイナリセマフォと役割りは同じ
  * 優先度逆転を考慮した仕組みが実装されてる
  * セマフォに比べて処理が重い

* 実装時の注意事項
  * 優先度逆転
    * 優先度逆転は 1 つのセマフォを 2 つ以上のタスク(コンテキスト)で操作しようとするから発生する
    * 対策 セマフォ2つ用意する
      * セマフォの関数をニューテックスの関数に置き換えただけでは何も変わらない
  * デッドロック
    * 複数のタスクが同じ順番でセマフォ確保すること
    * セマフォの扱いは入れ子とすること
    * 入れ子にしなくてもデッドロック回避できるが、入れ子のほうが分かりやすい
